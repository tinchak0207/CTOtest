const eventsData = [
    {
        id: 1,
        title: {
            en: "Fashion Festival Creates a Cross-Border Creative Feast, GBA Fashion Gathers in Macau",
            zh: "服裝節打造跨界創意盛宴 灣區時尚匯聚澳門",
            pt: "Festival de Moda Cria um Banquete Criativo Transfronteiriço, Moda da GBA Reúne-se em Macau"
        },
        description: {
            en: "The 'Macao Fashion Festival 2025', co-organized by the Macau Productivity and Technology Transfer Center and the Macao Trade and Investment Promotion Institute, continued today (23rd) at the Venetian Macao's Florence Convention Center. The 'GBA Fashion Show' brought together six outstanding designers from Macau, Hong Kong, Shenzhen, and Guangzhou to lead the audience on a fashion journey exploring the culture of the Guangdong-Hong Kong-Macao Greater Bay Area (GBA).",
            zh: "由澳門生產力暨科技轉移中心與招商投資促進局合辦的“澳門服裝節2025”，今(23)日於澳門威尼斯人佛羅倫斯會議廳精彩續演，“大灣區時尚匯演”匯聚澳門、香港、深圳及廣州六組優秀設計師，攜手引領觀眾探索粵港澳大灣區（下稱“大灣區”）文化的時尚之旅。",
            pt: "O 'Festival de Moda de Macau 2025', co-organizado pelo Centro de Produtividade e Transferência de Tecnologia de Macau e pelo Instituto de Promoção do Comércio e do Investimento de Macau, continuou hoje (23) no Centro de Convenções Florence do Venetian Macao. O 'Desfile de Moda da GBA' reuniu seis excelentes designers de Macau, Hong Kong, Shenzhen e Guangzhou para guiar o público numa viagem de moda explorando a cultura da Grande Baía de Guangdong-Hong Kong-Macau (GBA)."
        },
        category: "fashion",
        type: "seminar",
        date: "2025-10-23",
        time: "14:00-18:00",
        duration: "4 hours",
        location: {
            en: "Venetian Macao, Florence Convention Hall",
            zh: "澳門威尼斯人佛羅倫斯會議廳",
            pt: "Venetian Macao, Salão de Convenções Florence"
        },
        instructor: {
            en: "GBA Designers",
            zh: "大灣區設計師",
            pt: "Designers da GBA"
        },
        fee: "Free",
        totalSeats: 100,
        availableSeats: 25,
        language: {
            en: "Multilingual",
            zh: "多語言",
            pt: "Multilíngue"
        }
    },
    {
        id: 2,
        title: {
            en: "Issue 703: New Quality Productivity",
            zh: "第703期新質生產力",
            pt: "Edição 703: Nova Produtividade de Qualidade"
        },
        description: {
            en: "【Latest Issue】Issue 703 of Macao Daily News's New Quality Productivity Bi-monthly: - 【Corporate Interview】Admittedly's Leapfrog Development Empowers All Industries - 【1+4 Dynamics】Deepening GMP Practice: Empowering Macao's Pharmaceutical Industry to a New International Milestone...",
            zh: "【最新一期】第703期澳門日報新質生產力半月刊內容：\n\n– 【企業專訪】愛達利跨越發展賦能百業\n\n– 【1+4動態】深化GMP實踐：賦能澳門醫藥產業邁向國際新里程\n\n– 【時尚創意及技術篇】生產力為婚慶行業發展育人才\n\n– 【ISO發佈】ISO 22002-4:2025食品安全前提方案 第4部分：食品包材製造\n\n– 商務特選課程\n\n文章連結：https://www.macaodaily.com/html/2025-10/23/node_44.htm",
            pt: "【Última Edição】Edição 703 do Bi-mensal de Nova Produtividade de Qualidade do Macao Daily News: - 【Entrevista Corporativa】O Desenvolvimento Salto da Admittedly Capacita Todas as Indústrias - 【Dinâmicas 1+4】Aprofundando a Prática de GMP: Capacitando a Indústria Farmacêutica de Macau para um Novo Marco Internacional..."
        },
        category: "management",
        type: "seminar",
        date: "2025-10-23",
        time: "09:00-17:00",
        duration: "Full day",
        location: {
            en: "Online",
            zh: "線上",
            pt: "Online"
        },
        instructor: {
            en: "N/A",
            zh: "N/A",
            pt: "N/A"
        },
        fee: "Free",
        totalSeats: 999,
        availableSeats: 999,
        language: {
            en: "Chinese",
            zh: "中文",
            pt: "Chinês"
        }
    },
    {
        id: 3,
        title: {
            en: "Macao Fashion Festival Kicks Off, Integrating Technology and Fashion Creativity",
            zh: "澳門服裝節拉開帷幕 融合科技與時尚創意",
            pt: "Festival de Moda de Macau Começa, Integrando Tecnologia e Criatividade de Moda"
        },
        description: {
            en: "The 'Macao Fashion Festival 2025', co-organized by the Macau Productivity and Technology Transfer Center and the Macao Trade and Investment Promotion Institute, officially kicked off today (22nd). The four-day event, held at the Venetian Macao's Florence Convention Hall, will showcase new Macao fashion designs.",
            zh: "由澳門生產力暨科技轉移中心與招商投資促進局合辦的“澳門服裝節2025”於今(22)日正式揭幕。活動由即日起一連四日，假澳門威尼斯人佛羅倫斯會議廳舉行，呈獻澳門時尚設計新作。開幕式以機械科技元素為載體，結合六位本澳新銳時裝設計師的創意，打造融合時尚與科技的表演，共同感受跨界時尚魅力。",
            pt: "O 'Festival de Moda de Macau 2025', co-organizado pelo Centro de Produtividade e Transferência de Tecnologia de Macau e pelo Instituto de Promoção do Comércio e do Investimento de Macau, começou oficialmente hoje (22). O evento de quatro dias, realizado no Salão de Convenções Florence do Venetian Macao, apresentará novos designs de moda de Macau."
        },
        category: "fashion",
        type: "seminar",
        date: "2025-10-22",
        time: "10:00-18:00",
        duration: "8 hours",
        location: {
            en: "Venetian Macao, Florence Convention Hall",
            zh: "澳門威尼斯人佛羅倫斯會議廳",
            pt: "Venetian Macao, Salão de Convenções Florence"
        },
        instructor: {
            en: "Various Designers",
            zh: "多位設計師",
            pt: "Vários Designers"
        },
        fee: "Free",
        totalSeats: 200,
        availableSeats: 50,
        language: {
            en: "Multilingual",
            zh: "多語言",
            pt: "Multilíngue"
        }
    },
    {
        id: 4,
        title: {
            en: "Smart Fashion: Robotics Driving the Future Sharing Session",
            zh: "智能時尚：機械人驅動未來分享會",
            pt: "Moda Inteligente: Robótica a Impulsionar a Sessão de Partilha do Futuro"
        },
        description: {
            en: "Online registration is now open for the 'Smart Fashion: Robotics Driving the Future' sharing session.",
            zh: "智能時尚：機械人驅動未來分享會，現正接受網上報名。",
            pt: "As inscrições online estão agora abertas para a sessão de partilha 'Moda Inteligente: Robótica a Impulsionar o Futuro'."
        },
        category: "fashion",
        type: "seminar",
        date: "2025-10-25",
        time: "14:30-16:00",
        duration: "1.5 hours",
        location: {
            en: "Online",
            zh: "線上",
            pt: "Online"
        },
        instructor: {
            en: "Industry Experts",
            zh: "行業專家",
            pt: "Especialistas da Indústria"
        },
        fee: "Free",
        totalSeats: 100,
        availableSeats: 45,
        language: {
            en: "Cantonese",
            zh: "廣東話",
            pt: "Cantonês"
        }
    },
    {
        id: 5,
        title: {
            en: "Online Seminar on Building Management",
            zh: "樓宇管理線上專題講座",
            pt: "Seminário Online sobre Gestão de Edifícios"
        },
        description: {
            en: "Online Seminar on Building Management – Safety Precautions for Building Power Supply Systems (SEM27-10-2025-SMTA). Seminar Date: 2025-10-31, 19:30-20:30. Registration Period: Oct 13 to Oct 28.",
            zh: "樓宇管理線上專題講座 – 樓宇供電系統安全須知 (SEM27-10-2025-SMTA)\n講座日期：2025年10月31日，19:30-20:30\n報名日期：10月13日至10月28日",
            pt: "Seminário Online sobre Gestão de Edifícios – Precauções de Segurança para Sistemas de Fornecimento de Energia de Edifícios (SEM27-10-2025-SMTA). Data do Seminário: 31-10-2025, 19:30-20:30. Período de Inscrição: 13 de Out a 28 de Out."
        },
        category: "management",
        type: "seminar",
        date: "2025-10-31",
        time: "19:30-20:30",
        duration: "1 hour",
        location: {
            en: "Online",
            zh: "線上",
            pt: "Online"
        },
        instructor: {
            en: "Invited Speaker",
            zh: "特邀講者",
            pt: "Orador Convidado"
        },
        fee: "Free",
        totalSeats: 150,
        availableSeats: 80,
        language: {
            en: "Cantonese",
            zh: "廣東話",
            pt: "Cantonês"
        }
    },
    {
        id: 6,
        title: {
            en: "Opening Ceremony of 'Huawei Digital Talent Foundation Program' Successfully Held",
            zh: "“華為數字化人才基礎研修計劃” 開班儀式順利舉行",
            pt: "Cerimónia de Abertura do 'Programa de Fundação de Talentos Digitais da Huawei' Realizada com Sucesso"
        },
        description: {
            en: "The opening ceremony of the 'Huawei Digital Talent Foundation Program', jointly organized by the Labour Affairs Bureau (DSAL) of the Macao SAR Government and the Livelihood Affairs Bureau of the Guangdong-Macao In-Depth Cooperation Zone in Hengqin, supported by Huawei Services (Hong Kong) Co., Limited - Macau Branch, and undertaken by the Macau Productivity and Technology Transfer Center (CPTTM), was successfully held this morning (9th) at the CPTTM head office auditorium.",
            zh: "由澳門特別行政區政府勞工事務局（下稱“勞工局”）與橫琴粵澳深度合作區民生事務局（下稱“民生局”）聯合主辦，華為服務（香港）有限公司-澳門分公司（下稱“華為澳門”）支持，澳門生產力暨科技轉移中心（下稱“生產力中心”）承辦的“華為數字化人才基礎研修計劃”開班儀式今日（9日）上午在澳門生產力暨科技轉移中心總辦事處演講廳順利舉行。",
            pt: "A cerimónia de abertura do 'Programa de Fundação de Talentos Digitais da Huawei', organizada conjuntamente pela Direção dos Serviços para os Assuntos Laborais (DSAL) do Governo da RAEM e pelo Departamento de Assuntos de Subsistência da Zona de Cooperação Aprofundada Guangdong-Macau em Hengqin, com o apoio da Huawei Services (Hong Kong) Co., Limited - Sucursal de Macau, e executada pelo Centro de Produtividade e Transferência de Tecnologia de Macau (CPTTM), foi realizada com sucesso esta manhã (9) no auditório da sede do CPTTM."
        },
        category: "it",
        type: "course",
        date: "2025-10-09",
        time: "10:00-11:00",
        duration: "1 hour",
        location: {
            en: "CPTTM Head Office Auditorium",
            zh: "澳門生產力暨科技轉移中心總辦事處演講廳",
            pt: "Auditório da Sede do CPTTM"
        },
        instructor: {
            en: "Huawei Certified Instructor",
            zh: "華為認證導師",
            pt: "Instrutor Certificado Huawei"
        },
        fee: "Free",
        totalSeats: 30,
        availableSeats: 0,
        language: {
            en: "Cantonese",
            zh: "廣東話",
            pt: "Cantonês"
        }
    }
];

let currentPage = 1;
const eventsPerPage = 6;
let filteredEvents = [...eventsData];
let currentFilters = {
    category: 'all',
    type: 'all',
    startDate: '',
    endDate: '',
    searchQuery: ''
};

function getLocalizedValue(obj, lang) {
    return obj[lang] || obj.en;
}

function filterEvents() {
    filteredEvents = eventsData.filter(event => {
        const matchesCategory = currentFilters.category === 'all' || event.category === currentFilters.category;
        const matchesType = currentFilters.type === 'all' || event.type === currentFilters.type;
        
        let matchesDate = true;
        if (currentFilters.startDate) {
            matchesDate = matchesDate && event.date >= currentFilters.startDate;
        }
        if (currentFilters.endDate) {
            matchesDate = matchesDate && event.date <= currentFilters.endDate;
        }
        
        let matchesSearch = true;
        if (currentFilters.searchQuery) {
            const query = currentFilters.searchQuery.toLowerCase();
            const titleEn = getLocalizedValue(event.title, 'en').toLowerCase();
            const titleZh = getLocalizedValue(event.title, 'zh').toLowerCase();
            const titlePt = getLocalizedValue(event.title, 'pt').toLowerCase();
            const descEn = getLocalizedValue(event.description, 'en').toLowerCase();
            const descZh = getLocalizedValue(event.description, 'zh').toLowerCase();
            const descPt = getLocalizedValue(event.description, 'pt').toLowerCase();
            
            matchesSearch = titleEn.includes(query) || titleZh.includes(query) || 
                          titlePt.includes(query) || descEn.includes(query) || 
                          descZh.includes(query) || descPt.includes(query);
        }
        
        return matchesCategory && matchesType && matchesDate && matchesSearch;
    });
    
    currentPage = 1;
}

function renderEvents() {
    const eventsGrid = document.getElementById('events-grid');
    const totalPages = Math.ceil(filteredEvents.length / eventsPerPage);
    
    if (filteredEvents.length === 0) {
        eventsGrid.innerHTML = `
            <div class="empty-state" style="grid-column: 1/-1;">
                <i class="fas fa-calendar-times"></i>
                <h3>${t('eventCard.noResults')}</h3>
                <p>${t('eventCard.tryDifferentFilters')}</p>
            </div>
        `;
        document.getElementById('current-page').textContent = '0';
        document.getElementById('total-pages').textContent = '0';
        updatePaginationButtons(totalPages);
        return;
    }
    
    const startIndex = (currentPage - 1) * eventsPerPage;
    const endIndex = startIndex + eventsPerPage;
    const paginatedEvents = filteredEvents.slice(startIndex, endIndex);

    eventsGrid.innerHTML = paginatedEvents.map(event => `
        <div class="event-card" data-event-id="${event.id}">
            <div class="event-card-header">
                <span class="event-category ${event.category}">${t('categories.' + event.category + '.title')}</span>
                <span class="event-type">${t('filter.' + event.type)}</span>
            </div>
            <h3 class="event-title">${getLocalizedValue(event.title, currentLang)}</h3>
            <p class="event-date">${event.date}</p>
            <p class="event-description">${getLocalizedValue(event.description, currentLang).substring(0, 100)}...</p>
            <div class="event-card-footer">
                <div class="event-seats">
                    ${event.availableSeats > 0 
                        ? `<i class="fas fa-chair"></i> ${event.availableSeats} ${t('eventCard.seatsAvailable')}`
                        : `<span class="fully-booked">${t('eventCard.fullyBooked')}</span>`
                    }
                    ${event.availableSeats > 0 && event.availableSeats < 10 ? `<span class="limited-seats">${t('eventCard.limitedSeats')}</span>` : ''}
                </div>
                <button class="register-btn" ${event.availableSeats === 0 ? 'disabled' : ''}>${t('eventCard.register')}</button>
            </div>
        </div>
    `).join('');
    
    document.getElementById('current-page').textContent = currentPage;
    document.getElementById('total-pages').textContent = totalPages;

    updatePaginationButtons(totalPages);
    
    document.querySelectorAll('.event-card').forEach(card => {
        card.addEventListener('click', () => {
            const eventId = card.getAttribute('data-event-id');
            showEventDetail(eventId);
        });
    });
}

function updatePaginationButtons(totalPages) {
    const prevPageBtn = document.getElementById('prev-page');
    const nextPageBtn = document.getElementById('next-page');
    
    prevPageBtn.disabled = currentPage === 1;
    nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
}

function showEventDetail(eventId) {
    const event = eventsData.find(e => e.id == eventId);
    if (!event) return;
    
    const modal = document.getElementById('event-modal');
    const modalContent = document.getElementById('event-detail-content');
    
    modalContent.innerHTML = `
        <div class="event-detail-header" style="background-image: url('assets/${event.category}.jpg')">
            <h2>${getLocalizedValue(event.title, currentLang)}</h2>
        </div>
        <div class="event-detail-body">
            <div class="event-detail-info">
                <p><strong>${t('eventDetail.date')}:</strong> ${event.date}</p>
                <p><strong>${t('eventDetail.time')}:</strong> ${event.time}</p>
                <p><strong>${t('eventDetail.location')}:</strong> ${getLocalizedValue(event.location, currentLang)}</p>
                <p><strong>${t('eventDetail.instructor')}:</strong> ${getLocalizedValue(event.instructor, currentLang)}</p>
                <p><strong>${t('eventDetail.duration')}:</strong> ${event.duration}</p>
                <p><strong>${t('eventDetail.language')}:</strong> ${getLocalizedValue(event.language, currentLang)}</p>
                <p><strong>${t('eventDetail.fee')}:</strong> ${event.fee}</p>
                <p><strong>${t('eventDetail.seats')}:</strong> ${event.availableSeats} / ${event.totalSeats}</p>
            </div>
            <div class="event-detail-description">
                <p>${getLocalizedValue(event.description, currentLang)}</p>
            </div>
        </div>
        <div class="event-detail-footer">
            <button class="share-btn"><i class="fas fa-share-alt"></i> ${t('eventDetail.share')}</button>
            <button class="register-now-btn" ${event.availableSeats === 0 ? 'disabled' : ''}>${t('eventDetail.register')}</button>
        </div>
    `;
    
    modal.style.display = 'block';
}

function initEvents() {
    renderEvents();
    
    document.getElementById('prev-page').addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            renderEvents();
        }
    });

    document.getElementById('next-page').addEventListener('click', () => {
        const totalPages = Math.ceil(filteredEvents.length / eventsPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            renderEvents();
        }
    });
    
    document.getElementById('apply-filters').addEventListener('click', () => {
        currentFilters.category = document.getElementById('category-filter').value;
        currentFilters.type = document.getElementById('type-filter').value;
        currentFilters.startDate = document.getElementById('start-date').value;
        currentFilters.endDate = document.getElementById('end-date').value;
        filterEvents();
        renderEvents();
    });
    
    const heroSearchInput = document.getElementById('hero-search-input');
    heroSearchInput.addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            currentFilters.searchQuery = heroSearchInput.value;
            filterEvents();
            renderEvents();
        }
    });
    
    document.querySelector('.search-btn').addEventListener('click', () => {
        currentFilters.searchQuery = heroSearchInput.value;
        filterEvents();
        renderEvents();
    });
}

window.renderEvents = renderEvents;

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initEvents);
} else {
    initEvents();
}
